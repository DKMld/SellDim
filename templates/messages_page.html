<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Messages</title>
</head>




<html>
  <body>
  <textarea id="chat-text" cols="80" rows="30"></textarea><br>
  <input id="input" type="text" size="80"><br>
  <input id="submit" type="button" value="Send Message">


  
        <div id="user-hello"></div>


        {{ room_name|json_script:'room_name' }}
        {{ request.user.username|json_script:'user_username' }}
        <script>
            const roomName = JSON.parse(document.getElementById('room_name').textContent);
            const user_username = JSON.parse(document.getElementById('user_username').textContent);

            document.querySelector('#submit').onclick = function (e) {
                const messageInputDom = document.querySelector('#input');
                const message = messageInputDom.value;
                chatSocket.send(JSON.stringify({
                    'message': message,
                    'user_username': user_username
                }))
                messageInputDom.value = '';

            };



            const chatSocket = new WebSocket(
                'ws://' +
                window.location.host +
                '/ws/chat/' +
                roomName +
                '/'
            );

            chatSocket.addEventListener('error', (event) => {
                console.log('WebSocket error: ', event);
            });

            chatSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                console.log(data)

                document.querySelector('#chat-text').value += (data.user_username + ':' + ' ' + data.message + '\n')
            };
        </script>



{#    <center><h1>Hello , Welcome to my chat site ! {{request.user}}</h1></center>#}
{#    <br>#}
{#    {% if request.user.is_authenticated  %}#}
{#    <center> Logout the chat Page <a href = "{% url 'log out' %}">Logout</a></center>#}
{#    {% endif %}#}
{#    <div#}
{#      class="chat__item__container"#}
{#      id="id_chat_item_container"#}
{#      style="font-size: 20px"#}
{#    >#}
{#      <br />#}
{#      <input type="text" id="id_message_send_input" />#}
{#      <button type="submit" id="id_message_send_button">Send Message</button>#}
{#      <br />#}
{#      <br />#}
{#    </div>#}
{#    <script>#}
{#      const chatSocket = new WebSocket("ws://" + window.location.host + "/");#}
{#      chatSocket.onopen = function (e) {#}
{#        console.log("The connection was setup successfully !");#}
{#      };#}
{#      chatSocket.onclose = function (e) {#}
{#        console.log("Something unexpected happened !");#}
{#      };#}
{#      document.querySelector("#id_message_send_input").focus();#}
{#      document.querySelector("#id_message_send_input").onkeyup = function (e) {#}
{#        if (e.keyCode == 13) {#}
{#          document.querySelector("#id_message_send_button").click();#}
{#        }#}
{#      };#}
{#      document.querySelector("#id_message_send_button").onclick = function (e) {#}
{#        var messageInput = document.querySelector(#}
{#          "#id_message_send_input"#}
{#        ).value;#}
{#        chatSocket.send(JSON.stringify({ message: messageInput, username : "{{request.user.username}}"}));#}
{#      };#}
{#      chatSocket.onmessage = function (e) {#}
{#        const data = JSON.parse(e.data);#}
{#        var div = document.createElement("div");#}
{#        div.innerHTML = data.username + " : " + data.message;#}
{#        document.querySelector("#id_message_send_input").value = "";#}
{#        document.querySelector("#id_chat_item_container").appendChild(div);#}
{#      };#}
{#    </script>#}
  </body>
</html>